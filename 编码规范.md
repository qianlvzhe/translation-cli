# Translation CLI é¡¹ç›®ç¼–ç è§„èŒƒ

æœ¬æ–‡æ¡£åŸºäºMonolithé¡¹ç›®ç¼–ç é£æ ¼æ¨¡æ¿ï¼Œç»“åˆTranslation CLIé¡¹ç›®çš„å®é™…éœ€æ±‚å’ŒæŠ€æœ¯æ ˆç‰¹ç‚¹ï¼Œæä¾›äº†å…¨é¢çš„Rustç¼–ç è§„èŒƒæŒ‡å—ã€‚

## é¡¹ç›®æ¦‚è§ˆ

Translation CLIæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½å‘½ä»¤è¡ŒHTMLç¿»è¯‘å·¥å…·ï¼Œä½¿ç”¨å†…ç½®ç´¢å¼•ç¿»è¯‘æŠ€æœ¯ï¼Œæ”¯æŒç½‘é¡µçˆ¬å–ã€HTMLå¤„ç†ã€æ–‡æœ¬ç¿»è¯‘å’Œä¸´æ—¶æ–‡ä»¶ç®¡ç†ç­‰åŠŸèƒ½ã€‚

## é¡¹ç›®ç»“æ„ä¸ç»„ç»‡

### ç›®å½•ç»“æ„
```
translation-cli/
â”œâ”€â”€ Cargo.toml              # é¡¹ç›®é…ç½®æ–‡ä»¶
â”œâ”€â”€ README.md               # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ src/                    # æ ¸å¿ƒæºä»£ç 
â”‚   â”œâ”€â”€ lib.rs             # åº“å…¥å£æ–‡ä»¶ï¼Œå¯¼å‡ºæ¨¡å—
â”‚   â”œâ”€â”€ main.rs            # å¯æ‰§è¡Œæ–‡ä»¶å…¥å£
â”‚   â”œâ”€â”€ api_constants.rs   # APIå¸¸é‡å®šä¹‰
â”‚   â”œâ”€â”€ config.rs          # é…ç½®ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ html_processor.rs  # HTMLå¤„ç†æ¨¡å—
â”‚   â”œâ”€â”€ stats.rs           # ç»Ÿè®¡åŠŸèƒ½æ¨¡å—
â”‚   â”œâ”€â”€ temp_manager.rs    # ä¸´æ—¶æ–‡ä»¶ç®¡ç†
â”‚   â”œâ”€â”€ translator.rs      # ç¿»è¯‘æ ¸å¿ƒåŠŸèƒ½
â”‚   â”œâ”€â”€ utils.rs           # é€šç”¨å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ web_crawler.rs     # ç½‘é¡µçˆ¬å–æ¨¡å—
â”œâ”€â”€ tests/                 # æµ‹è¯•ä»£ç 
â”‚   â”œâ”€â”€ test_data/         # æµ‹è¯•æ•°æ®
â”‚   â””â”€â”€ output/            # æµ‹è¯•è¾“å‡º
â”œâ”€â”€ examples/              # ç¤ºä¾‹ä»£ç 
â””â”€â”€ target/                # æ„å»ºè¾“å‡ºç›®å½•
```

### æ¨¡å—ç»„ç»‡åŸåˆ™
- æ¯ä¸ªæ¨¡å—è´Ÿè´£å•ä¸€èŒè´£
- ä½¿ç”¨`pub mod module_name`åœ¨lib.rsä¸­å¯¼å‡ºæ¨¡å—
- æµ‹è¯•ä»£ç ä¸æºä»£ç ç»“æ„å¯¹åº”
- åŠŸèƒ½æ¨¡å—æŒ‰èŒè´£æ˜ç¡®åˆ†ç¦»ï¼šé…ç½®ã€å¤„ç†ã€ç¿»è¯‘ã€çˆ¬å–ç­‰

## Cargo.tomlé…ç½®é£æ ¼

### é¡¹ç›®å…ƒä¿¡æ¯
```toml
[package]
name = "translation-cli"
version = "0.1.0"
edition = "2021"
description = "ç‹¬ç«‹çš„é«˜æ€§èƒ½å‘½ä»¤è¡ŒHTMLç¿»è¯‘å·¥å…·ï¼Œä½¿ç”¨å†…ç½®ç´¢å¼•ç¿»è¯‘æŠ€æœ¯"
authors = ["ä½œè€…åç§° <email@example.com>"]
homepage = "https://github.com/user/translation-cli"
repository = "https://github.com/user/translation-cli"
readme = "README.md"
keywords = ["translation", "html", "cli", "multilingual"]
categories = ["command-line-utilities", "internationalization"]
license = "MIT"
```

### ä¾èµ–ç®¡ç†
- **ç‰ˆæœ¬æ§åˆ¶**: ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶
- **ç‰¹æ€§æ§åˆ¶**: æ˜ç¡®æŒ‡å®šéœ€è¦çš„ç‰¹æ€§
- **å¼‚æ­¥æ”¯æŒ**: ä½¿ç”¨tokioä½œä¸ºä¸»è¦å¼‚æ­¥è¿è¡Œæ—¶

```toml
[dependencies]
# CLIæ„å»º
clap = { version = "4.0", features = ["derive"] }

# å¼‚æ­¥è¿è¡Œæ—¶
tokio = { version = "1.42", features = ["full"] }
futures = "0.3"

# HTTPå®¢æˆ·ç«¯
reqwest = { version = "0.12", features = ["json"] }
serde_json = "1.0"

# HTMLå¤„ç†
html5ever = "0.35"
markup5ever_rcdom = "0.35.0-unofficial"

# é”™è¯¯å¤„ç†
anyhow = "1.0"

# æ—¥å¿—ç³»ç»Ÿ
tracing = "0.1"
tracing-subscriber = "0.3"

# Webå†…å®¹æŠ“å–
monolith = { version = "2.10.1", default-features = false }
```

### åº“é…ç½®
```toml
[lib]
name = "translation_cli"
path = "src/lib.rs"
```

## ä»£ç å‘½åçº¦å®š

### å‘½åè§„åˆ™
- **ç±»å‹åç§°**: PascalCase (`TranslationConfig`, `WebCrawler`, `InputSource`)
- **å‡½æ•°åç§°**: snake_case (`translate_with_indexed_mode`, `validate_input_source`)
- **å˜é‡åç§°**: snake_case (`output_path`, `total_start`, `input_source`)
- **å¸¸é‡åç§°**: SCREAMING_SNAKE_CASE (`API_URL`, `BATCH_SIZE`, `DEFAULT_LANG`)
- **æ¨¡å—åç§°**: snake_case (`web_crawler`, `html_processor`, `temp_manager`)

### è¯­ä¹‰åŒ–å‘½å
- ä½¿ç”¨æè¿°æ€§åç§°: `generate_output_path_for_source` è€Œä¸æ˜¯ `gen_path`
- å¸ƒå°”å€¼ä½¿ç”¨is/haså‰ç¼€: `is_url`, `has_extension`
- åŠ¨ä½œä½¿ç”¨åŠ¨è¯: `translate_`, `validate_`, `init_`, `format_`
- ç®¡ç†å™¨ç±»ä½¿ç”¨Manageråç¼€: `TempManager`
- ç»Ÿè®¡ç±»ä½¿ç”¨Statsåç¼€: `TranslationStats`

### ç±»å‹å®šä¹‰é£æ ¼
```rust
// æšä¸¾å®šä¹‰
#[derive(Debug, Clone, PartialEq)]
pub enum InputSource {
    File(PathBuf),
    Url(String),
}

// ç»“æ„ä½“å®šä¹‰
#[derive(Debug, Clone)]
pub struct TranslationConfig {
    pub lang: String,
    pub api_url: String,
    pub batch_size: usize,
    pub timeout: Duration,
}

// CLIå‚æ•°ç»“æ„
#[derive(Parser, Debug)]
#[command(name = "translation-cli")]
#[command(about = "é«˜æ€§èƒ½HTMLç¿»è¯‘å·¥å…·")]
pub struct Cli {
    /// è¾“å…¥æ–‡ä»¶è·¯å¾„æˆ–URL
    pub input: String,
    
    /// ç›®æ ‡è¯­è¨€ä»£ç 
    #[arg(short, long, default_value = "zh")]
    pub lang: String,
}
```

## é”™è¯¯å¤„ç†æ¨¡å¼

### ç»Ÿä¸€é”™è¯¯å¤„ç†
- é¡¹ç›®ä½¿ç”¨`anyhow`è¿›è¡Œé”™è¯¯å¤„ç†
- å‡½æ•°è¿”å›`Result<T, anyhow::Error>`
- ä½¿ç”¨`.context()`æ·»åŠ é”™è¯¯ä¸Šä¸‹æ–‡

```rust
use anyhow::{Context, Result};

pub async fn translate_file(path: &Path) -> Result<String> {
    let content = fs::read_to_string(path)
        .context(format!("è¯»å–æ–‡ä»¶å¤±è´¥: {}", path.display()))?;
    
    // å¤„ç†é€»è¾‘
    Ok(processed_content)
}
```

### é”™è¯¯å¤„ç†ç­–ç•¥
- å¯¹äºå¯æ¢å¤é”™è¯¯ä½¿ç”¨Result
- ä½¿ç”¨`?`æ“ä½œç¬¦è¿›è¡Œé”™è¯¯ä¼ æ’­
- æä¾›æœ‰æ„ä¹‰çš„é”™è¯¯ä¿¡æ¯å’Œä¸Šä¸‹æ–‡
- é¿å…ä¸å¿…è¦çš„`unwrap()`ï¼Œä¼˜å…ˆä½¿ç”¨é”™è¯¯å¤„ç†

## å¼‚æ­¥ç¼–ç¨‹è§„èŒƒ

### å¼‚æ­¥å‡½æ•°å®šä¹‰
```rust
#[tokio::main]
async fn main() -> Result<()> {
    // ä¸»å‡½æ•°é€»è¾‘
}

pub async fn async_function(param: Type) -> Result<ReturnType> {
    // å¼‚æ­¥å‡½æ•°å®ç°
}
```

### å¼‚æ­¥æœ€ä½³å®è·µ
- ä½¿ç”¨`#[tokio::main]`æ ‡è®°mainå‡½æ•°
- å¼‚æ­¥å‡½æ•°ä½¿ç”¨`async fn`å®šä¹‰
- ä½¿ç”¨`.await`ç­‰å¾…å¼‚æ­¥æ“ä½œ
- åˆç†ä½¿ç”¨å¹¶å‘æ“ä½œæé«˜æ€§èƒ½

## æ—¥å¿—è®°å½•è§„èŒƒ

### æ—¥å¿—çº§åˆ«ä½¿ç”¨
```rust
use tracing::{info, warn, error, debug};

// ä¿¡æ¯æ€§æ—¥å¿—
info!("ğŸš€ å¯åŠ¨HTMLç¿»è¯‘ - ç›®æ ‡: äºšç§’çº§æ€§èƒ½");

// è­¦å‘Šæ—¥å¿—  
warn!("âš ï¸ æ£€æµ‹åˆ°æ½œåœ¨é—®é¢˜: {}", issue);

// é”™è¯¯æ—¥å¿—
error!("âŒ æ“ä½œå¤±è´¥: {}", error);

// è°ƒè¯•æ—¥å¿—
debug!("ğŸ” è°ƒè¯•ä¿¡æ¯: {:?}", debug_data);
```

### æ—¥å¿—æ ¼å¼è§„èŒƒ
- ä½¿ç”¨è¡¨æƒ…ç¬¦å·å¢å¼ºå¯è¯»æ€§
- åŒ…å«ç›¸å…³ä¸Šä¸‹æ–‡ä¿¡æ¯
- é¿å…è¿‡åº¦æ—¥å¿—è®°å½•å½±å“æ€§èƒ½

## æ¨¡å—å¯è§æ€§è§„åˆ™

### å…¬å¼€æ¥å£è®¾è®¡
```rust
// åœ¨lib.rsä¸­å¯¼å‡ºæ¨¡å—
pub mod web_crawler;
pub mod temp_manager;
pub mod translator;
pub mod utils;
pub mod html_processor;

// å…¬å¼€å‡½æ•°
pub async fn translate_with_indexed_mode(
    content: &str,
    config: &TranslationConfig,
) -> Result<String>

// å…¬å¼€ç»“æ„ä½“
pub struct WebCrawler {
    client: reqwest::Client,
    pub config: CrawlerConfig,
}
```

### å¯è§æ€§åŸåˆ™
- æœ€å°åŒ–å…¬å¼€æ¥å£
- ä»…å¯¼å‡ºå¿…è¦çš„ç±»å‹å’Œå‡½æ•°
- ä½¿ç”¨`pub(crate)`ä¸ºå†…éƒ¨å¯è§æ€§
- ç§æœ‰å­—æ®µä¼˜äºå…¬å¼€å­—æ®µ

## æ€§èƒ½ä¼˜åŒ–è§„èŒƒ

### å†…å­˜ç®¡ç†
```rust
// é¢„åˆ†é…å®¹é‡
let mut results = Vec::with_capacity(expected_size);

// ä½¿ç”¨å¼•ç”¨é¿å…å…‹éš†
fn process_data(data: &str) -> Result<String> {
    // å¤„ç†é€»è¾‘
}

// é€‚å½“ä½¿ç”¨Cowç±»å‹
use std::borrow::Cow;
fn maybe_owned(input: &str) -> Cow<str> {
    // æ ¹æ®æ¡ä»¶è¿”å›å€Ÿç”¨æˆ–æ‹¥æœ‰çš„æ•°æ®
}
```

### å¼‚æ­¥æ€§èƒ½
- ä½¿ç”¨å¹¶å‘å¤„ç†æé«˜æ€§èƒ½
- åˆç†è®¾ç½®æ‰¹å¤„ç†å¤§å°
- é¿å…ä¸å¿…è¦çš„å¼‚æ­¥è¾¹ç•Œ

## æµ‹è¯•ä»£ç é£æ ¼

### æµ‹è¯•æ¨¡å—ç»„ç»‡
```rust
#[cfg(test)]
mod tests {
    use super::*;
    use tokio_test;
    
    #[tokio::test]
    async fn test_translation_functionality() {
        // æµ‹è¯•é€»è¾‘
        let result = translate_text("Hello").await;
        assert!(result.is_ok());
    }
    
    #[test]
    fn test_synchronous_function() {
        // åŒæ­¥æµ‹è¯•é€»è¾‘
        assert_eq!(expected, actual);
    }
}
```

### æµ‹è¯•å‘½åå’Œç»“æ„
- æµ‹è¯•å‡½æ•°ä»¥`test_`å¼€å¤´
- ä½¿ç”¨æè¿°æ€§æµ‹è¯•åç§°
- å¼‚æ­¥æµ‹è¯•ä½¿ç”¨`#[tokio::test]`
- åŒæ­¥æµ‹è¯•ä½¿ç”¨`#[test]`

## æ–‡æ¡£æ³¨é‡Šé£æ ¼

### æ–‡æ¡£æ³¨é‡Šä½¿ç”¨
```rust
//! æ¨¡å—çº§åˆ«æ–‡æ¡£æ³¨é‡Š
//! 
//! æè¿°æ¨¡å—çš„åŠŸèƒ½å’Œç”¨é€”

/// å‡½æ•°æˆ–ç±»å‹çš„æ–‡æ¡£æ³¨é‡Š
/// 
/// # Arguments
/// 
/// * `param` - å‚æ•°æè¿°
/// 
/// # Returns
/// 
/// è¿”å›å€¼æè¿°
/// 
/// # Errors
/// 
/// å¯èƒ½å‡ºç°çš„é”™è¯¯æƒ…å†µ
pub fn documented_function(param: &str) -> Result<String> {
    // å®ç°
}
```

### CLIå‚æ•°æ–‡æ¡£
```rust
/// è¾“å…¥æ–‡ä»¶è·¯å¾„æˆ–URL
#[arg(help = "è¦ç¿»è¯‘çš„HTMLæ–‡ä»¶è·¯å¾„æˆ–ç½‘é¡µURL")]
pub input: String,

/// ç›®æ ‡è¯­è¨€ä»£ç 
#[arg(short, long, default_value = "zh", help = "ç¿»è¯‘ç›®æ ‡è¯­è¨€ (å¦‚: zh, en, ja)")]
pub lang: String,
```

## ä»£ç æ ¼å¼åŒ–æ ‡å‡†

### å¯¼å…¥è¯­å¥ç»„ç»‡
```rust
// æ ‡å‡†åº“å¯¼å…¥
use std::fs;
use std::path::{Path, PathBuf};
use std::time::{Duration, Instant};

// ç¬¬ä¸‰æ–¹crateå¯¼å…¥
use anyhow::{Context, Result};
use clap::Parser;
use tokio::fs as async_fs;
use tracing::{info, error, warn};

// æœ¬åœ°æ¨¡å—å¯¼å…¥
use crate::config::{Cli, TranslationConfig};
use crate::utils::{validate_input_source, InputSource};
```

### å‡½æ•°å®šä¹‰é£æ ¼
```rust
pub async fn async_function_with_multiple_params(
    param1: &str,
    param2: usize,
    config: &TranslationConfig,
) -> Result<String> {
    // å‡½æ•°ä½“
}
```

## ç‰¹å®šæ¨¡å¼å’Œçº¦å®š

### é…ç½®ç®¡ç†æ¨¡å¼
```rust
#[derive(Debug, Clone)]
pub struct TranslationConfig {
    pub lang: String,
    pub api_url: String,
    pub batch_size: usize,
}

impl Default for TranslationConfig {
    fn default() -> Self {
        Self {
            lang: "zh".to_string(),
            api_url: get_api_url(),
            batch_size: get_batch_size(),
        }
    }
}
```

### ä¸´æ—¶æ–‡ä»¶ç®¡ç†æ¨¡å¼
```rust
pub struct TempManager {
    temp_dir: PathBuf,
}

impl TempManager {
    pub fn new() -> Result<Self> {
        // åˆå§‹åŒ–é€»è¾‘
    }
    
    pub fn create_temp_file(&self, suffix: &str) -> Result<PathBuf> {
        // åˆ›å»ºä¸´æ—¶æ–‡ä»¶
    }
}

impl Drop for TempManager {
    fn drop(&mut self) {
        // æ¸…ç†èµ„æº
    }
}
```

### æ€§èƒ½ç»Ÿè®¡æ¨¡å¼
```rust
#[derive(Debug)]
pub struct TranslationStats {
    pub total_time: Duration,
    pub translation_time: Duration,
    pub characters_processed: usize,
}

impl TranslationStats {
    pub fn chars_per_second(&self) -> f64 {
        self.characters_processed as f64 / self.total_time.as_secs_f64()
    }
}
```

## å®‰å…¨æ€§è§„èŒƒ

### è¾“å…¥éªŒè¯
- éªŒè¯æ‰€æœ‰å¤–éƒ¨è¾“å…¥
- æ¸…ç†å’Œè½¬ä¹‰ç”¨æˆ·æ•°æ®
- ä½¿ç”¨ç±»å‹ç³»ç»Ÿç¡®ä¿å®‰å…¨æ€§

### æ–‡ä»¶æ“ä½œå®‰å…¨
```rust
use std::path::Path;

pub fn safe_file_operation(path: &Path) -> Result<()> {
    // éªŒè¯è·¯å¾„å®‰å…¨æ€§
    if !path.exists() {
        return Err(anyhow!("æ–‡ä»¶ä¸å­˜åœ¨: {}", path.display()));
    }
    
    // å®‰å…¨æ“ä½œ
    Ok(())
}
```

## ç¼–ç æœ€ä½³å®è·µ

### ä»£ç ç»„ç»‡
1. ä¿æŒå‡½æ•°ç®€æ´ï¼Œå•ä¸€èŒè´£
2. ä½¿ç”¨æœ‰æ„ä¹‰çš„ä¸­é—´å˜é‡
3. é€‚å½“çš„ä»£ç åˆ†å±‚å’Œæ¨¡å—åŒ–
4. é¿å…æ·±åº¦åµŒå¥—

### å¯ç»´æŠ¤æ€§
- æ¸…æ™°çš„æ¨¡å—è¾¹ç•Œ
- æœ€å°åŒ–æ¨¡å—é—´ä¾èµ–
- ä¸€è‡´çš„é”™è¯¯å¤„ç†ç­–ç•¥
- å……åˆ†çš„æµ‹è¯•è¦†ç›–

### æ€§èƒ½è€ƒè™‘
- åˆç†ä½¿ç”¨å¼‚æ­¥å¹¶å‘
- é¿å…ä¸å¿…è¦çš„å†…å­˜åˆ†é…
- ä½¿ç”¨é€‚å½“çš„æ•°æ®ç»“æ„
- è€ƒè™‘ç¼“å­˜ç­–ç•¥

---

## ä½¿ç”¨æŒ‡å—

å½“å¼€å‘Translation CLIä»£ç æ—¶ï¼Œè¯·ç¡®ä¿ï¼š

1. **éµå¾ªå‘½åçº¦å®š**: ä½¿ç”¨snake_caseå’ŒPascalCase
2. **æ¨¡å—åŒ–è®¾è®¡**: åŠŸèƒ½ç›¸å…³ä»£ç ç»„ç»‡åœ¨åŒä¸€æ¨¡å—
3. **å¼‚æ­¥ä¼˜å…ˆ**: åˆç†ä½¿ç”¨å¼‚æ­¥ç¼–ç¨‹æé«˜æ€§èƒ½
4. **é”™è¯¯å¤„ç†**: ä½¿ç”¨anyhowå’ŒResultç±»å‹
5. **æ—¥å¿—è®°å½•**: æä¾›æœ‰æ„ä¹‰çš„æ—¥å¿—ä¿¡æ¯
6. **æµ‹è¯•è¦†ç›–**: ä¸ºæ–°åŠŸèƒ½æ·»åŠ å¯¹åº”æµ‹è¯•
7. **æ–‡æ¡£æ³¨é‡Š**: ä¸ºå…¬å¼€APIæä¾›æ¸…æ™°æ–‡æ¡£
8. **æ€§èƒ½ä¼˜åŒ–**: è€ƒè™‘å†…å­˜ä½¿ç”¨å’Œæ‰§è¡Œæ•ˆç‡
9. **å®‰å…¨æ€§**: éªŒè¯è¾“å…¥ï¼Œå®‰å…¨å¤„ç†æ–‡ä»¶æ“ä½œ

è¿™ä¸ªç¼–ç è§„èŒƒç»“åˆäº†Monolithé¡¹ç›®çš„æˆç†Ÿæ¨¡å¼å’ŒTranslation CLIé¡¹ç›®çš„å…·ä½“éœ€æ±‚ï¼Œæ—¨åœ¨ç¡®ä¿ä»£ç è´¨é‡ã€å¯ç»´æŠ¤æ€§å’Œæ€§èƒ½ã€‚